<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="color-scheme" content="light dark" />
  <title>剪辑师项目管理系统 · Life_HAN</title>
  <link rel="icon" href="icon.png?v=v1.5" />
  <link rel="stylesheet" href="styles.css?v=v1.5" />
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="nav-wrap container">
      <div class="brand">剪辑师项目管理系统 <span class="brand-gold">· Life_HAN</span></div>
      <nav class="nav-center">
        <button id="btn-home" class="nav-btn" aria-current="page">首页</button>
        <button id="btn-projects" class="nav-btn">项目</button>
        <button id="btn-schedule" class="nav-btn">档期</button>
        <button id="btn-gallery" class="nav-btn">作品合集</button>
        <button id="btn-finance" class="nav-btn">财务</button>
      </nav>
      <div class="nav-right">
        <button id="btn-theme" class="nav-btn ghost" title="切换深色/浅色">深色</button>
        <button id="btn-logout" class="nav-btn ghost">退出登录</button>
      </div>
    </div>
  </header>

  <!-- 登录 -->
  <section id="view-auth" class="container auth-view hidden">
    <div class="card auth-card">
      <h2>登录 / 注册</h2>
      <form id="auth-form" class="auth-form">
        <input id="email" type="email" required placeholder="邮箱" />
        <input id="password" type="password" required placeholder="密码" />
        <button type="submit">进入系统</button>
      </form>
      <p id="auth-tip" class="muted small"></p>
    </div>
  </section>

  <main class="container main-wrap">
    <!-- 首页 -->
    <section id="view-home" class="view">
      <div class="grid-3 kpi">
        <div class="card kpi-card kpi-gold"><div class="kpi-label">收入总金额</div><div id="kpi-total" class="kpi-num">¥0</div></div>
        <div class="card kpi-card kpi-yellow"><div class="kpi-label">已收款</div><div id="kpi-paid" class="kpi-num">¥0</div></div>
        <div class="card kpi-card kpi-red"><div class="kpi-label">未收款</div><div id="kpi-unpaid" class="kpi-num">¥0</div></div>
      </div>
      <div class="grid-2 kpi">
        <div class="card kpi-card"><div class="kpi-label">已完成片数</div><div id="kpi-done" class="kpi-num">0</div></div>
        <div class="card kpi-card"><div class="kpi-label">未完成片数</div><div id="kpi-todo" class="kpi-num">0</div></div>
      </div>
      <div id="home-asof" class="muted small asof"></div>

      <div class="card">
        <div class="section-head">
          <h3>最近项目</h3>
          <button id="go-list" class="btn-ghost">查看全部</button>
        </div>
        <div id="recent-list" class="list recent"></div>
      </div>

      <!-- 报价分析器（横向排版） -->
      <div class="card">
        <div class="section-head"><h3>报价分析器</h3></div>
        <form id="quote-form" class="form">
          <div class="grid-2">
            <label>项目名<input id="qa-title" /></label>
            <label>制片<input id="qa-producer" /></label>
          </div>
          <div class="muted small" style="margin:10px 0 6px">多组合模式：添加多组「类型 × 条数 × 时长」，每组可设置合成复杂度/创意/紧急/修改次数/基础价。</div>
          <div class="pill-group">
            <label class="pill"><input type="checkbox" id="qa-multi-toggle" checked><span>启用多组合计价</span></label>
            <label class="pill"><input type="checkbox" id="qa-advanced-toggle" checked><span>显示每组难度选项</span></label>
          </div>
          <div id="qa-single" class="hidden"></div>
          <div id="qa-multi">
            <div id="qa-mc-list"></div>
            <div style="margin-top:10px"><button type="button" id="qa-mc-add" class="cell-edit">新增组合</button></div>
          </div>
          <div class="grid-2" style="margin-top:10px">
            <div class="price-box"><div>不含税价</div><div id="qa-net" class="price">¥0</div></div>
            <div class="price-box"><div>含税价（+6%）</div><div id="qa-gross" class="price">¥0</div></div>
          </div>
        </form>
      </div>
    </section>

    <!-- 项目列表：未完成 + 已完成 -->
    <section id="view-projects" class="view hidden">
      <div class="section-head">
        <h2>项目列表</h2>
        <div class="toolbar"><button id="btn-new" class="btn">新建项目</button></div>
      </div>

      <div class="card">
        <div class="section-head"><h3>未完成项目</h3></div>
        <div id="projects-wrap" class="table-wrap">
          <table class="table projects-table">
            <thead>
              <tr>
                <th>项目</th>
                <th>合作制片</th>
                <th>影片类型&条数&规格</th>
                <th>进度</th>
                <th>优先级</th>
                <th>支付状态</th>
                <th>总金额</th>
                <th class="col-changes">修改内容</th>
                <th class="col-upload">上传</th>
              </tr>
            </thead>
            <tbody id="projects-body"></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="section-head"><h3>已完成项目（支付状态=已收尾款）</h3></div>
        <div id="completed-wrap" class="table-wrap table-fixed">
          <table class="table projects-table">
            <thead>
              <tr>
                <th>项目</th>
                <th>合作制片</th>
                <th>影片类型&条数&规格</th>
                <th>进度</th>
                <th>优先级</th>
                <th>支付状态</th>
                <th>总金额</th>
                <th class="col-changes">修改内容</th>
                <th class="col-upload">上传</th>
              </tr>
            </thead>
            <tbody id="completed-body"></tbody>
          </table>
        </div>
      </div>
    </section>
    
    <!-- 后续部分保持不变 --> 

  </main>
  <script src="app.js?v=v1.5" defer></script>
</body>
</html>
